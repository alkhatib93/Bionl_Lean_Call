{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/alkhatib93/Bionl_Lean_Call/main/nextflow_schema.json",
  "title": "Bionl_Lean_Call parameters",
  "description": "A germline variant-calling workflow focused on ACMG Secondary Findings (research use only), with standardized QC, annotation, and per-sample reports.",
  "type": "object",

  "$defs": {
    "io_options": {
      "title": "Input / Output",
      "type": "object",
      "properties": {
        "run_variant_calling": {
          "type": "boolean",
          "title": "Run Variant Calling",
          "description": "If true, run variant calling. If false, run post-processing only.",
          "default": true
        },
        "input": {
          "type": "string",
          "title": "Samplesheet CSV",
          "description": "CSV file for variant calling input. Required if run_variant_calling = true.",
          "mimetype": "text/csv",
          "format": "file-path",
          "pattern": "^\\S*\\.csv$"
        },
        "outdir": {
          "type": "string",
          "title": "Output directory",
          "description": "Where to write results (local path or gs://).",
          "format": "directory-path"
        },
        "variant_calling_outdir": {
          "type": "string",
          "title": "Existing variant calling results directory",
          "description": "Use a pre-run variant calling results folder if run_variant_calling=false. Cannot be used with post_samplesheet.",
          "format": "directory-path"
        },
        "post_samplesheet": {
          "type": "string",
          "title": "Post-only samplesheet CSV",
          "description": "CSV with sample,vcf,bam for post-variant calling mode. Cannot be used with variant_calling_outdir.",
          "mimetype": "text/csv",
          "format": "file-path",
          "pattern": "^\\S*\\.csv$"
        }
      }
    }
  },

  "allOf": [
    { "$ref": "#/$defs/io_options" },
    {
      "not": {
        "required": ["post_samplesheet", "variant_calling_outdir"],
        "description": "Cannot provide both post_samplesheet and variant_calling_outdir"
      }
    }
  ],

  "if": {
    "properties": { "run_variant_calling": { "const": true } }
  },
  "then": {
    "required": ["input", "outdir"],
    "description": "When run_variant_calling=true you must provide input (samplesheet) and outdir."
  },
  "else": {
    "required": ["outdir"],
    "oneOf": [
      {
        "required": ["post_samplesheet"],
        "not": { "required": ["variant_calling_outdir"] },
        "description": "Provide post_samplesheet without variant_calling_outdir"
      },
      {
        "required": ["variant_calling_outdir"],
        "not": { "required": ["post_samplesheet"] },
        "description": "Provide variant_calling_outdir without post_samplesheet"
      }
    ],
    "description": "When run_variant_calling=false you must provide outdir and either post_samplesheet OR variant_calling_outdir (not both)."
  },

  "additionalProperties": true
}