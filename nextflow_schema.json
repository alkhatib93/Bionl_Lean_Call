{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/alkhatib93/Bionl_Lean_Call/main/nextflow_schema.json",
  "title": "Bionl_Lean_Call parameters",
  "description": "A germline variant-calling workflow focused on ACMG Secondary Findings (research use only), with standardized QC, annotation, and per-sample reports.",
  "type": "object",

  "$defs": {
    "io_options": {
      "title": "Input / Output and Sarek options",
      "type": "object",
      "properties": {
        "run_sarek": {
          "type": "boolean",
          "title": "Run Sarek",
          "description": "If true, run nf-core/sarek. If false, run post-processing only.",
          "default": true
        },
        "input": {
          "type": "string",
          "title": "Samplesheet CSV",
          "description": "CSV file for Sarek input. Required if run_sarek = true.",
          "mimetype": "text/csv",
          "format": "file-path",
          "pattern": "^\\S*\\.csv$"
        },
        "outdir": {
          "type": "string",
          "title": "Output directory",
          "description": "Where to write results (local path or gs://).",
          "format": "directory-path"
        },
        "sarek_outdir": {
          "type": "string",
          "title": "Existing Sarek results directory",
          "description": "Use a pre-run Sarek results folder if run_sarek=false. Cannot be used with post_samplesheet.",
          "format": "directory-path"
        },
        "post_samplesheet": {
          "type": "string",
          "title": "Post-only samplesheet CSV",
          "description": "CSV with sample,vcf,bam for post-Sarek mode. Cannot be used with sarek_outdir.",
          "mimetype": "text/csv",
          "format": "file-path",
          "pattern": "^\\S*\\.csv$"
        }
      }
    },

    "post_sarek": {
      "title": "Post-Sarek annotation resources",
      "type": "object",
      "properties": {
        "vep_cache": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+$" },
        "vep_fasta": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+\\.f(ast)?a(\\.gz)?$" },
        "gnomad_vcf": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+\\.vcf(\\.gz)?$" },
        "revel_vcf": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+\\.(vcf|tsv)(\\.gz)?$" },
        "alpha_missense_vcf": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+\\.(vcf|tsv)(\\.gz)?$" },
        "clinvar_vcf": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+\\.vcf(\\.gz)?$" },
        "vep_plugins": { "type": "string", "format": "file-path", "pattern": "^(gs://|/|\\.|[A-Za-z]:\\\\).+$" }
      }
    }
  },

  "allOf": [
    { "$ref": "#/$defs/io_options" },
    { "$ref": "#/$defs/post_sarek" },
    {
      "not": {
        "required": ["post_samplesheet", "sarek_outdir"],
        "description": "Cannot provide both post_samplesheet and sarek_outdir"
      }
    }
  ],

  "if": {
    "properties": { "run_sarek": { "const": true } }
  },
  "then": {
    "required": ["input", "outdir"],
    "description": "When run_sarek=true you must provide input (samplesheet) and outdir."
  },
  "else": {
    "required": ["outdir"],
    "oneOf": [
      {
        "required": ["post_samplesheet"],
        "not": { "required": ["sarek_outdir"] },
        "description": "Provide post_samplesheet without sarek_outdir"
      },
      {
        "required": ["sarek_outdir"],
        "not": { "required": ["post_samplesheet"] },
        "description": "Provide sarek_outdir without post_samplesheet"
      }
    ],
    "description": "When run_sarek=false you must provide outdir and either post_samplesheet OR sarek_outdir (not both)."
  },

  "additionalProperties": true
}